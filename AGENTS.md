# Skillet

A skill registry toolkit for AI agents. CLI and MCP server.

Repo name is `grimoire`, crate/binary name is `skillet`.

## Build and test

```bash
cargo fmt --all -- --check
cargo clippy --all-targets --all-features -- -D warnings
cargo test --lib --all-features
cargo test --bin skillet --all-features
cargo doc --no-deps --all-features
```

Rust 2024 edition, minimum supported version 1.90.

## Architecture

Single crate, library + binary. `src/lib.rs` re-exports modules,
`src/main.rs` has the CLI (clap) and MCP server setup.

Key modules:
- `state.rs` -- `AppState`, `SkillIndex`, `SkillEntry`, `SkillVersion`, data models
- `index.rs` -- directory walking, `skill.toml`/`SKILL.md` parsing
- `search.rs` -- BM25 full-text search over skill metadata and content
- `cache.rs` -- persistent disk cache for `SkillIndex`
- `config.rs` -- `SkilletConfig`, `InstallTarget`, install paths
- `discover.rs` -- auto-discovery of locally installed agent skills
- `safety.rs` -- pattern-based static analysis for dangerous skill content
- `trust.rs` -- trust tiers and content hash pinning
- `install.rs` -- write skills to agent platform directories
- `registry.rs` -- multi-registry loading, clone/pull, cache coordination
- `tools/` -- MCP tools: `search_skills`, `list_categories`, `list_skills_by_owner`, `install_skill`, `info_skill`
- `resources/` -- MCP resources: `skill_content`, `skill_metadata`, `skill_files`

Key patterns:
- `AppState` holds `RwLock<SkillIndex>` and `RwLock<SkillSearch>`, both rebuilt on refresh
- `SkillIndex` maps `(owner, name)` to `SkillEntry`, with `merge()` for multi-registry (first registry wins)
- MCP tools/resources are capability-gated via `ServerCapabilities`
- All MCP tools follow the same pattern: `build(state) -> Tool` using `ToolBuilder` from `tower-mcp`

## Code style

- `anyhow` for application errors, `thiserror` for library errors (`src/error.rs`)
- Public APIs should have doc comments
- No emojis in code, commits, or documentation
- Conventional commits: `feat:`, `fix:`, `refactor:`, `test:`, `docs:`
- Prefer editing existing files over creating new ones
- Don't over-engineer: only add what's needed for the current task

## Testing

- Unit tests live in each module as `#[cfg(test)] mod tests`
- Binary integration tests in `src/main.rs` use `tower-mcp`'s test harness
- Test registry fixtures in `test-registry/` -- real skill.toml/SKILL.md files
- `tempfile` crate for temporary directories in tests
- No mocking framework; tests use real data structures

## Skill format

```
owner/skill-name/
  skill.toml       # Metadata for indexing (required)
  SKILL.md         # Agent prompt content (required)
  scripts/         # Optional executable scripts
  references/      # Optional reference docs
  assets/          # Optional templates, configs
  versions.toml    # Version history (generated by pack)
  MANIFEST.sha256  # Content hashes (generated by pack)
```

## CLI subcommands

- `skillet search <query>` -- search registries
- `skillet info <owner/name>` -- show skill detail
- `skillet install <owner/name>` -- install to agent directory
- `skillet list` -- list installed skills
- `skillet init-skill <path>` -- scaffold a skillpack
- `skillet validate <path>` -- validate a skillpack
- `skillet pack <path>` -- validate + manifest + version history
- `skillet publish <path> --repo <owner/repo>` -- pack + open PR
- `skillet init-registry <path>` -- scaffold a registry
- `skillet [serve]` -- run MCP server (default subcommand)
